<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MHTextBased</title>
</head>
<style>
    canvas {
    padding-left: 0;
    padding-right: 0;
    margin-left: auto;
    margin-right: auto;
    display: block;
}

body {
text-align: center;
}
</style>
<body">
    <div id="images" style="display:none;">
        <img id="source" src="images/snk-grant.gif"  width="300" height="227" />
    </div>
    <div id="mygame" class="mygame">
        <canvas id="canvas" width="800" height="600" style="border:1px solid #d3d3d3;"></canvas>
        <p style="text-align: center;" id="message">Welcome to MHTextBased please enter a name</p>
        <div id="gameStart">
            <input type="text" id="name">
            <button id type="button" onclick="makePlayer()">Enter Name</button>
            </div>
            <div id="combat">
            <p id="status"></p>
            <p id="action"></p>
            <button id="attack" onclick="player.attack()" type="button">Attack</button>
            <button id="defend" onclick="player.defend()" type="button">Defend</button>
            <button id="nextTurn" onclick="combat()" type="button" disabled>Next Turn</button>
            </div>
    </div>
</body>
<script>
function display(){
    let start = document.getElementById('gameStart')
    let combat = document.getElementById('combat')
    start.style.display = 'block'
    combat.style.display = 'none'
}
document.onload = display()
    window.onload = function() {
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const image = document.getElementById("source");
  ctx.drawImage(image, 60,300);
    }
</script>

<script>
    //loop and gameEnd variables
//used for transitioning scenes
let gameEnd = false;
let endLoop = false;

//probability function used for all random chance events
function probability(n) {
    return Math.random() < n;
}

//takes a min and max and choose a random number between the two of them
function randomNumber(min, max) {
    return Math.floor(Math.random() * (max - min + 1) + min)
}
//monster names array, add to it if you want
let names = [
    'Barnos',
    'Gajalaka',
    'Gajau',
    'Gastodon',
    'Girros',
    'Grimalkyne',
    'Kestodon',
    'Mernos',
    'Noios',
    'Raphinos',
    'Rathalos',
    'Jagras'
];
//sets up the monster object used in combat
class Monster {
    constructor(name, power, value) {
        this.name = name;
        this.power = power;
        this.value = value;
        this.hp
        this.armor
    }
    //creates a new monster when the function is called
    //always edit the values in here when you want to balance patch
    newMonster() {
        this.name = names[Math.floor(Math.random() * names.length)]
        this.hp = randomNumber(100, 300);
        this.armor = randomNumber(0, 30);
        this.power = randomNumber(25, 40);
        this.value = this.power;
    }
}
//initalizes the monster object with default values
let monster = new Monster('', 0, 0, 0, 0)


//creates the player object
//all parameters are logged in here
class Hero {
    constructor(name, hp, power, money, defense, wUpgrade, dUpgrade, monstersKilled) {
        this.name = name;
        this.hp = hp;
        this.power = power;
        this.money = money;
        this.defense = defense;
        this.wUpgrade = wUpgrade;
        this.dUpgrade = dUpgrade;
        this.monstersKilled = monstersKilled;
    }


     attack(){
        let nextTurn = document.getElementById('nextTurn')
        let attackBut = document.getElementById('attack')
        let defendBut = document.getElementById('defend')
        action.innerHTML = `You attack the ${monster.name}`
        let criticalHit = false;
        if (probability(0.10)) {
            criticalHit = true
        }

        if (!criticalHit) {
            monster.hp -= this.power - monster.armor
            action.innerHTML += `<br>${monster.name} retaliates`;
            this.hp -= monster.power - this.defense
        } else if (criticalHit) {
         action.innerHTML += `<br>CRITICAL HIT!` ;
         monster.hp -= this.power
         action.innerHTML += `<br>${monster.name} retaliates`;
         this.hp -= monster.power - this.defense
        }
        attackBut.disabled = true;
        defendBut.disabled = true;
        nextTurn.disabled = false;
    }

    defend(){
                 let nextTurn = document.getElementById('nextTurn')
                 let attackBut = document.getElementById('attack')
                  let defendBut = document.getElementById('defend')
                  //this uses if statements to determine if a random event will occur
                  //add or edit these to make combat more enthralling
                  action.innerHTML = `You enter a ready stance anticipating the ${monster.name}'s next move`;
                  let parry = false;
                  if (probability(0.35)) {
                      parry = true
                  }
                  if (probability(0.50)) {
                    action.innerHTML += `<br>You narrowly escape the ${monster.name}'s attack`;
                  } else if (parry) {
                    action.innerHTML = `<br>You send ${monster.name}'s attack right back at it!!`;
                      monster.hp -= monster.power - monster.armor
                  } else if (probability(0.40)) {
                      //hp should always stack, unlless it's with a potion
                      action.innerHTML += '<br>You manage to find time to recover some strength and enhance your body with magic';
                      action.innerHTML += '<br>+20 hp';
                      this.hp += 20;
                  } else {
                    action.innerHTML += `<br>${monster.name} attacks`;
                      this.hp -= monster.power - this.defense + 20
                  }
                  attackBut.disabled = true;
                  defendBut.disabled = true;
                  nextTurn.disabled = false;
              }
}
//used during monster hunts to initiate combat
function combat() {
    let start = document.getElementById('gameStart')
    let combat = document.getElementById('combat')
    let nextTurn = document.getElementById('nextTurn')
    let attackBut = document.getElementById('attack')
    let defendBut = document.getElementById('defend')
    nextTurn.disabled = true
    defendBut.disabled = false;
    attackBut.disabled = false;
    start.style.display = 'none'
    combat.style.display = 'block'
    let status = document.getElementById('status')
    let action = document.getElementById('action')
        status.innerHTML = 'Your hp is ' + player.hp
        let message = document.getElementById('message')
        if (monster.hp > 0 && player.hp > 0) {
            status.innerHTML += `<br>Would you like to Attack or Defend? `
            //checks who dies first
            //monster will always die first
        } else if (monster.hp <= 0) {
           message.innerHTML = `${monster.name} has been hunted`;
           status.innerHTML = ''
           action.innerHTML = ''
            player.money += Math.floor(monster.value);
            endLoop = true;
            player.monstersKilled++
            postFight()
        } else if (player.hp <= 0) {
            alert('Game Over')
        }
    }
    let player = new Hero('', 0, 0, 0, 0, 1, 1, 0)
function makePlayer(){
    player.hp = 100
    player.power = 40
    player.money = 30
    player.defense = 15
    player.name = document.getElementById('name').value


    gameStart()

}

//game loop variables
let turns = 0;
let storyEvent1 = false;

function gameStart() {
    let message = document.getElementById('message')
    //Hunting monsters
    //diffculty scales
    //story progression follows player.monstersKilled
    if (player.monstersKilled < 1) {
        message.innerHTML = 'Your first hunt will be a very easy one, your defense will take away some of the monsters power, so you just have to overpower it'
        monster.name = 'Jagras'
        monster.power = 25
        monster.value = 10
        monster.armor = 0
        monster.hp = 60
        combat()
    } else if (player.monstersKilled < 5 && player.monstersKilled > 0) {
        //story event 1
        //balance the boss to make it challengeing and fun
        if (player.monstersKilled == 4) {
            console.log("You approach the den of a beast unlike any other you've seen.");
            console.log("As you approach it's wings unfurl in grandiose fashion");
            console.log("The legendary monster SkyBreaker approaches!!!!!!!");
            monster.name = 'SkyBreaker'
            monster.power = 50
            monster.hp = 300
            monster.armor = 0
            monster.value = 100
            storyEvent1 = true;
           combat()
        } else {
            monster.newMonster();
            console.log(`-----${player.name} goes for a hunt!-----`);
            console.log(`${monster.name} attacks!!`);
            combat()
        }
        //raises the monsters stats to scale with the player
    } else if (player.monstersKilled >= 5) {
        monster.newMonster();
        monster.power += randomNumber(10, 60)
        console.log(`-----${player.name} goes for a hunt!-----`);
        console.log(`${monster.name} attacks!!`);
        combat()
    }

}

//everything that happens after a hunt
//include merchant, story scenes, and will include save states
function postFight() {

    if (endLoop == true) {
        if (gameEnd == false) {
            //only active after the first story event
            if (player.monstersKilled == 5) {
                console.log("You deliver the monster's head to the guild, suprised as ever they promote you to elite rank");
                console.log("Your max hp increases by 100 and your weapon and armor improve");
                hHp += 100
                player.power += 60
                player.defense += 20
            }
            //resets player hp
            player.hp = 100;
            //shop function
            function merchant() {
                'Shopkeep: Hello there! Welcome to my shop, please have a look below-------'
                'gold: ' + player.money
                'power: ' + Math.floor(player.power)
                'defense: ' + Math.floor(player.defense)
                //sets what items are for sale
                //scales with the player's purchases
                let itemsForSale = {
                    armor: {
                        item: 'armor upgrade',
                        defense: 10,
                        price: 30 * player.dUpgrade
                    },
                    weapon: {
                        item: 'weapon upgrade',
                        power: 30,
                        price: 30 * player.wUpgrade
                    }
                }
                console.log(itemsForSale.armor.item + ' Grants ' + itemsForSale.armor.defense + ' defense' + ' cost: ' + itemsForSale.armor.price);
                console.log(itemsForSale.weapon.item + ' Grants ' + itemsForSale.weapon.power + ' power' + ' cost: ' + itemsForSale.weapon.price);
                    //checks which item was purchased
                    //if the player doesn't have enough money they can't buy any "Sorry link I don't give credit"
                    //works fine, but will need to build on it when items are added
                    function buyItem() {
                        if (item.toLowerCase() == itemsForSale.weapon.item) {
                            if (itemsForSale.weapon.price > player.money) {
                                rl.question(`Merchant: Sorry bud you ain't got enough money`, () => {
                                    console.clear()
                                    merchant()
                                })
                            } else {
                                player.power += itemsForSale.weapon.power
                                player.money -= itemsForSale.weapon.price
                                player.wUpgrade++
                                console.log('Thanks for your purchase');
                                console.clear()
                                merchant()
                            }
                        } else if (item.toLowerCase() == itemsForSale.armor.item) {
                            if (itemsForSale.armor.price > player.money) {
                                rl.question(`Merchant: Sorry bud you ain't got enough money`, () => {
                                    console.clear()
                                    merchant()
                                })
                            } else {
                                player.defense += itemsForSale.armor.defense
                                player.money -= itemsForSale.armor.price
                                player.dUpgrade++
                                console.log('Thanks for your purchase');
                                console.clear()
                                merchant()
                            }
                        } else if (item.toLowerCase() == 'leave') {
                            console.log('Have a nice day! Happy hunting!');
                            rl.question(`Next hunt?`, () => {
                                endLoop = false;
                                gameStart()
                            })
                        } else {
                        }
                    }
                    buyItem()
            }
            rl.question(`Enter the shop by hitting enter...`, answer => {
                merchant()
            })
        }
    }

}
</script>
</html>
